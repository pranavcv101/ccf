<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6">
    <div class="max-w-5xl mx-auto bg-gray-800 p-8 rounded-lg shadow-lg">
        <h2 class="text-3xl font-bold text-center text-blue-400 mb-6">Booking Details</h2>

        <!-- Filter form -->
        <form class="mb-4">
            <div class="mb-3">
                <label for="rollno" class="block text-gray-300 mb-1">Roll Number</label>
                <input type="text" id="rollno" oninput="filterBookings()" placeholder="Enter roll number"
                       class="w-full p-3 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
            </div>
            <div class="mb-3">
                <label for="comp_id" class="block text-gray-300 mb-1">Computer ID</label>
                <input type="text" id="comp_id" oninput="filterBookings()" placeholder="Enter computer ID"
                       class="w-full p-3 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
            </div>
            <div class="mb-3">
                <label for="date" class="block text-gray-300 mb-1">Booking Date</label>
                <input type="date" id="date" oninput="filterBookings()"
                       class="w-full p-3 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
            </div>
        </form>

        <!-- Table to display booking details -->
        <div class="overflow-x-auto">
            <table id="booking-table" class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-blue-500 text-white">
                        <th class="p-3">Booking ID</th>
                        <th class="p-3">User Roll No</th>
                        <th class="p-3">Computer ID</th>
                        <th class="p-3">Start Time</th>
                        <th class="p-3">Duration (minutes)</th>
                        <th class="p-3">Status</th>
                        <th class="p-3">Action</th>
                    </tr>
                </thead>
                <tbody class="bg-gray-700 divide-y divide-gray-600">
                    {% for booking in bookings %}
                    <tr class="hover:bg-gray-600">
                        <td class="p-3">{{ booking.id }}</td>
                        <td class="p-3 user-rollno">{{ booking.user_rollno }}</td>
                        <td class="p-3 computer-id">{{ booking.comp_id }}</td>
                        <td class="p-3 booking-datetime">{{ booking.start_time }}</td>
                        <td class="p-3">{{ booking.duration }}</td>
                        <td class="p-3">{{ booking.status }}</td>
                        <td class="p-3">
                            <form method="POST" action="{{ url_for('cancel_a_booking', booking_id=booking.id) }}" onsubmit="return confirmCancel()">
                                <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700">Cancel</button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" class="p-3 text-center text-gray-400">No bookings found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function filterBookings() {
            var rollno = document.getElementById('rollno').value.toLowerCase();
            var compId = document.getElementById('comp_id').value.toLowerCase();
            var date = document.getElementById('date').value;
            var table = document.getElementById('booking-table');
            var rows = table.getElementsByTagName('tr');
            
            for (var i = 1; i < rows.length; i++) { // Skip the header row
                var row = rows[i];
                var userRollno = row.getElementsByClassName('user-rollno')[0].textContent.toLowerCase();
                var computerId = row.getElementsByClassName('computer-id')[0].textContent.toLowerCase();
                var bookingDatetime = row.getElementsByClassName('booking-datetime')[0].textContent;
                
                // Normalize the booking datetime to date string (remove time portion)
                var bookingDate = bookingDatetime.split(' ')[0]; // Assuming the format is 'YYYY-MM-DD'

                // Check conditions and apply filters
                var matchesRollno = rollno ? userRollno.includes(rollno) : true;
                var matchesCompId = compId ? computerId.includes(compId) : true;
                var matchesDate = date ? bookingDate === date : true;
    
                // Show row if it matches any filter condition
                if (matchesRollno  && matchesCompId && matchesDate) {
                    row.style.display = ''; // Show the row
                } else {
                    row.style.display = 'none'; // Hide the row
                }
            }
        }

        function confirmCancel() {
            return confirm("Are you sure you want to cancel this booking?");
        }
    </script>
</body>
</html>
